Post Test Suite Processing --- how to zip the Report Folder in Katalon Studio
====

This is a small [Katalon Studio](https://www.katalon.com/katalon-studio/) project for demonstration purpose.

You can download the zip at the [releases page](https://github.com/kazurayam/Post_TestSuite_processing/releases).

This project was developed using Katalon Studio v8.1.0 but is not dependent on the KS version.
It should work on every versions of KS.

This project is meant to propose a solution to the discussion raised in Katalon Forum at

- [How to zip the Report Folder](https://forum.katalon.com/t/how-to-zip-the-report-folder/58763)

## Caution

I used Mac. This project assumes that `/bin/sh` command is available, which is usually true on Mac and Linux.

## Demonstration

This project demonstrates how to make a zip file of Reports generated by a Test Suite execution.

Please download this project, open it with your local Katalon Studio, run a Test Suite Collection named `TSC`. It would demonstrate a few points, which would be interesing for those who want to *zip the Report Folder created by Test Suites*.

1. Open a Test Suite Collection named `Test Suites/TCS`. It comprises with 2 Test Suites.
  * `Test Suites/TS1`
  * `Test Suites/TS_post_TS1_processing`
1. Click the Execute button to run it. It will run for a few seconds. ![01_TSC](docs/images/01_TSC.png)
1. The `TSC` will run for a few seconds. *It will fail*. It fails intentionally for demostration purpose. Don't mind it.
1. Once `TSC` finished, a folder named `out` will be be created under the project directory. However, Katalon Studio has a bug; *the new `out` folder will not be displayed in the Test Explorer pane*. So, please close the project once and reopen it in order to let Katalon Studio be acknowled of the new `out` folder. ![02_out](docs/images/02_out_folder.png)
1. In the `out` folder, you will find two files created by the `TSC`. Here `yyyyMMdd_hhmmss` represent a varying timestamp.
  * `out/consume_TS_report.sh`
  * `out/Reports_yyyyMMdd_hhmmss.zip`
5. Please check the content of the `Reports_yyyyMMdd_hhmmss.zip` file using your favorite archiver tool. In the zip file, the contents of the `Reports/yyyyMMdd_hhmmss/TS1/yyyyMMdd_hhss2` folder is archived. It contains the test report in HTML/CSV/XML generated by a Test Suite named `Test Suites/TS1`. ![03_zip](docs/images/03_zip.png)
6. During `TSC` is executed, the `Test Suite/TS1` is called, which calls a Test Case `TC1`. `TC1` is a skeltal Test Case sample, like this:
```
import com.kms.katalon.core.webui.keyword.WebUiBuiltInKeywords as WebUI

WebUI.comment("Here you can do whatever you like")
```
7. Katalon Studio will generate a set of reports of `Test Suite/TS1` into the folder `Reports/yyyyMMdd_hhmmss/TS1/yyyyMMdd_hhss2`.
8. After `TS1`, `TSC` calls one more Test Suite `TS_post_TS1_processing`. It will make a zip file in the `out` folder at `out/Reports_yyyyMMdd_hhmmss.zip`.

The `TSC` demonstrates that the Test Suite `TS_post_TS1_processing` can make a zip file of the Reports generated by the Test Suite `TS1`.

## Problem to solve

Why I developed this demo project? Let me tell it you.

Katalon Studio users often want to make a zip file of the Reports of a Test Suite execution. If you don't mind doing it manually after the Test Suite finished, you can:

1. In Windows Explorer GUI, open the project folder
2. Dig the folder tree to reach `<projectDir>/Reports/yyyyMMdd_hhmmss/testSuiteName/yyyyMMdd_hhmmss2` folder
3. Right-click the folder and choose "archive it" menu.
4. You are done. You will get a zip file which contains HTML/CSV/XML reports.

But I don't like to do it manually. I want to **automate zipping the Reports**. Not only creating the file, I want to transfer it to some remote storage for further processing.

How can I do it in a Katalon Studio project?

## Technical difficulties

I found 3 technical issues to overcome.

### Timing issue

People naively expects that HTML/XML reports of a Test Suite `TS1` to be present and accessible in the Report folder when a method in TestListener annotated by `@AfterTestSuite` is invoked. Unfortunately the fact is not. When the `@AfterTestSuite` method is invoked, the HTML/XML reports are not yet there.

I can show a proof.




HTML/XML reports are generated by Katalon Studio after the TestSuite has been completely processed. 

### Variable path

The Report folder path includes variable timestamp yyyyMMddhh_mmss, not fixed

### How to run a Command from Groovy

In order to create a zip file of a folder contents, I want to use the good old bash shell commands: `zip`, `mv`, `cp`, `rm`, `mkdir`, `echo` etc. Also I want to use `curl` command to transfer files over network. I can create, by Groovy, a shell script file named `cmd.sh`. How can I execute a shell script `cmd.sh` with bash shell from my Groovy script?

## Proposed solution

### Running Shell Script using the subprocessj library

The `java.lang.ProcessBuilder` class enables running arbitrary commands in a new process from Groovy script. The following article covers how to use it.

- [How to run a Shell command in Java](https://www.baeldung.com/run-shell-command-in-java)

## Description
